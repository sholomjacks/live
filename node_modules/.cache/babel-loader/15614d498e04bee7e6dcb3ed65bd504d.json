{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ramda_1 = require(\"ramda\");\n\nvar serialize = require('serialize-javascript');\n\nexports.is_array = function (el) {\n  return ramda_1.type(el) === 'Array';\n};\n\nexports.is_object = function (el) {\n  return ramda_1.type(el) === 'Object';\n};\n\nexports.is_array_or_object = function (el) {\n  return ramda_1.type(el) === 'Array' || ramda_1.type(el) === 'Object';\n};\n\nexports.is_numeric_string = ramda_1.test(/^0$|^[1-9][0-9]*$/);\n\nexports.path_to_key = function (path) {\n  return ramda_1.type(path) === \"Array\" ? path.join('.') : path;\n};\n\nexports.key_to_path = function (path) {\n  return ramda_1.type(path) === \"String\" ? ramda_1.compose(ramda_1.map(function (el) {\n    return exports.is_numeric_string(el) ? Number(el) : el;\n  }), ramda_1.split('.'))(path) : path;\n};\n\nexports.stringify = function (value) {\n  return serialize(value, {\n    ignoreFunction: true\n  });\n};\n\nexports.parse = function (serializedJavascript) {\n  return eval('(' + serializedJavascript + ')');\n};\n\nexports.concat_if_nonexistent = function (array, append_array) {\n  return ramda_1.compose(ramda_1.uniq, ramda_1.concat(array))(append_array);\n}; // returns new_pairs with all the index values from existing_pairs merged in\n\n\nexports.merge_keys = function (existing_pairs, new_pairs, keys) {\n  return ramda_1.reduce(function (acc, val) {\n    var existing_value = existing_pairs[val];\n    var new_value = new_pairs[val];\n\n    if (!Array.isArray(existing_value) || !Array.isArray(new_value)) {\n      return ramda_1.assoc(val, new_value, acc);\n    } else {\n      var merged_value = exports.concat_if_nonexistent(existing_value, new_value);\n      return ramda_1.assoc(val, merged_value, acc);\n    }\n  }, new_pairs)(keys);\n};\n\nvar json_to_path_list = function (val) {\n  if (Array.isArray(val)) {\n    var child_paths = ramda_1.unnest(val.map(function (child, i) {\n      return json_to_path_list(child).map(function (path) {\n        return __spreadArrays([i], path);\n      });\n    }));\n    return ramda_1.concat([[]], child_paths);\n  }\n\n  if (exports.is_object(val)) {\n    var child_paths = ramda_1.compose(ramda_1.concat([[]]), ramda_1.chain(function (key, i) {\n      return json_to_path_list(val[key]).map(function (path) {\n        return __spreadArrays([key], path);\n      });\n    }))(ramda_1.keys(val));\n    return child_paths;\n  }\n\n  return [[]];\n};\n\nexports.who_cares = function (changes, subscriptions) {\n  return ramda_1.reduce(function (acc, val) {\n    var changed_key = val;\n    var new_val = changes.new_pairs[changed_key];\n    var old_val = changes.old_pairs[changed_key];\n    var relevant_subscription_keys = ramda_1.keys(subscriptions).filter(function (key) {\n      return ramda_1.startsWith(key)(changed_key);\n    });\n    return ramda_1.concat(relevant_subscription_keys.map(function (watched_key) {\n      var fns = subscriptions[watched_key];\n      return {\n        watched_key: watched_key,\n        changed_key: changed_key,\n        new_val: new_val,\n        old_val: old_val,\n        fns: fns\n      };\n    }), acc);\n  }, [])(ramda_1.keys(changes.old_pairs));\n}; // like pathOr but doesnt return null when value is null and not undefined\n\n\nexports.strict_path_or = function (default_val, val_path, obj) {\n  if (val_path.length === 0) {\n    return obj;\n  }\n\n  if (ramda_1.hasPath(val_path, obj)) {\n    return ramda_1.path(val_path, obj);\n  } else {\n    return default_val;\n  }\n};\n\nexports.json_to_pairs = function (json) {\n  var path_list = json_to_path_list(json);\n  return ramda_1.reduce(function (acc, val) {\n    var _a;\n\n    var redis_key = exports.path_to_key(val);\n    var given_value = exports.strict_path_or(undefined, val, json);\n    var redis_value = exports.is_array_or_object(given_value) ? ramda_1.keys(given_value) : given_value;\n    return __assign(__assign({}, acc), (_a = {}, _a[redis_key] = redis_value, _a));\n  }, {})(path_list);\n};\n\nexports.pairs_to_json = function (pairs) {\n  var output = {};\n  var paths = ramda_1.compose(ramda_1.map(function (key) {\n    return {\n      path: exports.key_to_path(key),\n      val: pairs[key]\n    };\n  }), ramda_1.keys)(pairs);\n  paths.map(function (path_el) {\n    return output = ramda_1.assocPath(path_el.path, path_el.val, output);\n  });\n  return output;\n};\n\nexports.map_keys = ramda_1.curry(function (fn, obj) {\n  return ramda_1.fromPairs(ramda_1.map(ramda_1.adjust(0, fn), ramda_1.toPairs(obj)));\n});\nexports.concat_with_dot = ramda_1.curry(function (a, b) {\n  return ramda_1.compose(ramda_1.join('.'), ramda_1.reject(ramda_1.isEmpty))([a, b]);\n});\n\nexports.delete_parent_indices = function (missing_paths, data) {\n  var output = ramda_1.reduce(function (acc, val) {\n    var _a;\n\n    var old_index = acc[exports.path_to_key(ramda_1.dropLast(1, val))];\n    if (ramda_1.isNil(old_index)) return acc;\n    var new_index = ramda_1.without(ramda_1.toString(ramda_1.last(val)))(old_index);\n    var key_to_update = exports.path_to_key(ramda_1.dropLast(1, val));\n\n    var update_obj = __assign(__assign({}, acc), (_a = {}, _a[key_to_update] = new_index, _a));\n\n    return update_obj;\n  }, data, missing_paths);\n  return output;\n};\n\nvar sample_json = {\n  name: 'John',\n  age: 30,\n  cars: ['Ford', 'BMW', 'fiat'],\n  settings: {\n    likes_pizza: false,\n    wants_daily_emails: true\n  }\n};\nvar pointers = {\n  'redibase_': ['name', 'age', 'cars', 'settings'],\n  'redibase_cars': [0, 1, 2],\n  'redibase_settings': ['likes_pizza', 'wants_daily_emails']\n};\nvar redis_entries = {\n  'redibase_age': 30,\n  'redibase_cars.0': 'Ford',\n  'redibase_cars.1': 'BMW',\n  'redibase_cars.2': 'fiat',\n  'redibase_name': 'John',\n  'redibase_settings.likes_pizza': false,\n  'redibase_settings.wants_daily_emails': true\n};","map":{"version":3,"sources":["C:/Users/gamem/codecademy/node_modules/redibase/build/pure.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArrays","il","r","Array","k","a","j","jl","defineProperty","exports","value","ramda_1","require","serialize","is_array","el","type","is_object","is_array_or_object","is_numeric_string","test","path_to_key","path","join","key_to_path","compose","map","Number","split","stringify","ignoreFunction","parse","serializedJavascript","eval","concat_if_nonexistent","array","append_array","uniq","concat","merge_keys","existing_pairs","new_pairs","keys","reduce","acc","val","existing_value","new_value","isArray","assoc","merged_value","json_to_path_list","child_paths","unnest","child","chain","key","who_cares","changes","subscriptions","changed_key","new_val","old_val","old_pairs","relevant_subscription_keys","filter","startsWith","watched_key","fns","strict_path_or","default_val","val_path","obj","hasPath","json_to_pairs","json","path_list","_a","redis_key","given_value","undefined","redis_value","pairs_to_json","pairs","output","paths","path_el","assocPath","map_keys","curry","fn","fromPairs","adjust","toPairs","concat_with_dot","b","reject","isEmpty","delete_parent_indices","missing_paths","data","old_index","dropLast","isNil","new_index","without","toString","last","key_to_update","update_obj","sample_json","name","age","cars","settings","likes_pizza","wants_daily_emails","pointers","redis_entries"],"mappings":"AAAA;;AACA,IAAIA,QAAQ,GAAI,QAAQ,KAAKA,QAAd,IAA2B,YAAY;AAClDA,EAAAA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAASC,CAAT,EAAY;AACpC,SAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;AACjDD,MAAAA,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;AACA,WAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AACP;;AACD,WAAON,CAAP;AACH,GAPD;;AAQA,SAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CAVD;;AAWA,IAAIO,cAAc,GAAI,QAAQ,KAAKA,cAAd,IAAiC,YAAY;AAC9D,OAAK,IAAIV,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAG,CAAf,EAAkBU,EAAE,GAAGR,SAAS,CAACC,MAAtC,EAA8CH,CAAC,GAAGU,EAAlD,EAAsDV,CAAC,EAAvD,EAA2DD,CAAC,IAAIG,SAAS,CAACF,CAAD,CAAT,CAAaG,MAAlB;;AAC3D,OAAK,IAAIQ,CAAC,GAAGC,KAAK,CAACb,CAAD,CAAb,EAAkBc,CAAC,GAAG,CAAtB,EAAyBb,CAAC,GAAG,CAAlC,EAAqCA,CAAC,GAAGU,EAAzC,EAA6CV,CAAC,EAA9C,EACI,KAAK,IAAIc,CAAC,GAAGZ,SAAS,CAACF,CAAD,CAAjB,EAAsBe,CAAC,GAAG,CAA1B,EAA6BC,EAAE,GAAGF,CAAC,CAACX,MAAzC,EAAiDY,CAAC,GAAGC,EAArD,EAAyDD,CAAC,IAAIF,CAAC,EAA/D,EACIF,CAAC,CAACE,CAAD,CAAD,GAAOC,CAAC,CAACC,CAAD,CAAR;;AACR,SAAOJ,CAAP;AACH,CAND;;AAOAf,MAAM,CAACqB,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,OAAO,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,IAAIC,SAAS,GAAGD,OAAO,CAAC,sBAAD,CAAvB;;AACAH,OAAO,CAACK,QAAR,GAAmB,UAAUC,EAAV,EAAc;AAAE,SAAOJ,OAAO,CAACK,IAAR,CAAaD,EAAb,MAAqB,OAA5B;AAAsC,CAAzE;;AACAN,OAAO,CAACQ,SAAR,GAAoB,UAAUF,EAAV,EAAc;AAAE,SAAOJ,OAAO,CAACK,IAAR,CAAaD,EAAb,MAAqB,QAA5B;AAAuC,CAA3E;;AACAN,OAAO,CAACS,kBAAR,GAA6B,UAAUH,EAAV,EAAc;AAAE,SAAOJ,OAAO,CAACK,IAAR,CAAaD,EAAb,MAAqB,OAArB,IAAgCJ,OAAO,CAACK,IAAR,CAAaD,EAAb,MAAqB,QAA5D;AAAuE,CAApH;;AACAN,OAAO,CAACU,iBAAR,GAA4BR,OAAO,CAACS,IAAR,CAAa,mBAAb,CAA5B;;AACAX,OAAO,CAACY,WAAR,GAAsB,UAAUC,IAAV,EAAgB;AAAE,SAAOX,OAAO,CAACK,IAAR,CAAaM,IAAb,MAAuB,OAAvB,GAAiCA,IAAI,CAACC,IAAL,CAAU,GAAV,CAAjC,GAAkDD,IAAzD;AAAgE,CAAxG;;AACAb,OAAO,CAACe,WAAR,GAAsB,UAAUF,IAAV,EAAgB;AAAE,SAAOX,OAAO,CAACK,IAAR,CAAaM,IAAb,MAAuB,QAAvB,GAAkCX,OAAO,CAACc,OAAR,CAAgBd,OAAO,CAACe,GAAR,CAAY,UAAUX,EAAV,EAAc;AAAE,WAAON,OAAO,CAACU,iBAAR,CAA0BJ,EAA1B,IAAgCY,MAAM,CAACZ,EAAD,CAAtC,GAA6CA,EAApD;AAAyD,GAArF,CAAhB,EAAwGJ,OAAO,CAACiB,KAAR,CAAc,GAAd,CAAxG,EAA4HN,IAA5H,CAAlC,GAAsKA,IAA7K;AAAoL,CAA5N;;AACAb,OAAO,CAACoB,SAAR,GAAoB,UAAUnB,KAAV,EAAiB;AAAE,SAAOG,SAAS,CAACH,KAAD,EAAQ;AAAEoB,IAAAA,cAAc,EAAE;AAAlB,GAAR,CAAhB;AAAoD,CAA3F;;AACArB,OAAO,CAACsB,KAAR,GAAgB,UAAUC,oBAAV,EAAgC;AAAE,SAAOC,IAAI,CAAC,MAAMD,oBAAN,GAA6B,GAA9B,CAAX;AAAgD,CAAlG;;AACAvB,OAAO,CAACyB,qBAAR,GAAgC,UAAUC,KAAV,EAAiBC,YAAjB,EAA+B;AAAE,SAAOzB,OAAO,CAACc,OAAR,CAAgBd,OAAO,CAAC0B,IAAxB,EAA8B1B,OAAO,CAAC2B,MAAR,CAAeH,KAAf,CAA9B,EAAqDC,YAArD,CAAP;AAA4E,CAA7I,C,CACA;;;AACA3B,OAAO,CAAC8B,UAAR,GAAqB,UAAUC,cAAV,EAA0BC,SAA1B,EAAqCC,IAArC,EAA2C;AAAE,SAAO/B,OAAO,CAACgC,MAAR,CAAe,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACxG,QAAIC,cAAc,GAAGN,cAAc,CAACK,GAAD,CAAnC;AACA,QAAIE,SAAS,GAAGN,SAAS,CAACI,GAAD,CAAzB;;AACA,QAAI,CAAC1C,KAAK,CAAC6C,OAAN,CAAcF,cAAd,CAAD,IAAkC,CAAC3C,KAAK,CAAC6C,OAAN,CAAcD,SAAd,CAAvC,EAAiE;AAC7D,aAAOpC,OAAO,CAACsC,KAAR,CAAcJ,GAAd,EAAmBE,SAAnB,EAA8BH,GAA9B,CAAP;AACH,KAFD,MAGK;AACD,UAAIM,YAAY,GAAGzC,OAAO,CAACyB,qBAAR,CAA8BY,cAA9B,EAA8CC,SAA9C,CAAnB;AACA,aAAOpC,OAAO,CAACsC,KAAR,CAAcJ,GAAd,EAAmBK,YAAnB,EAAiCN,GAAjC,CAAP;AACH;AACJ,GAVwE,EAUtEH,SAVsE,EAU3DC,IAV2D,CAAP;AAU5C,CAVtB;;AAWA,IAAIS,iBAAiB,GAAG,UAAUN,GAAV,EAAe;AACnC,MAAI1C,KAAK,CAAC6C,OAAN,CAAcH,GAAd,CAAJ,EAAwB;AACpB,QAAIO,WAAW,GAAGzC,OAAO,CAAC0C,MAAR,CAAeR,GAAG,CAACnB,GAAJ,CAAQ,UAAU4B,KAAV,EAAiB/D,CAAjB,EAAoB;AACzD,aAAO4D,iBAAiB,CAACG,KAAD,CAAjB,CAAyB5B,GAAzB,CAA6B,UAAUJ,IAAV,EAAgB;AAAE,eAAOtB,cAAc,CAAC,CAACT,CAAD,CAAD,EAAM+B,IAAN,CAArB;AAAmC,OAAlF,CAAP;AACH,KAFgC,CAAf,CAAlB;AAGA,WAAOX,OAAO,CAAC2B,MAAR,CAAe,CAAC,EAAD,CAAf,EAAqBc,WAArB,CAAP;AACH;;AACD,MAAI3C,OAAO,CAACQ,SAAR,CAAkB4B,GAAlB,CAAJ,EAA4B;AACxB,QAAIO,WAAW,GAAGzC,OAAO,CAACc,OAAR,CAAgBd,OAAO,CAAC2B,MAAR,CAAe,CAAC,EAAD,CAAf,CAAhB,EAAsC3B,OAAO,CAAC4C,KAAR,CAAc,UAAUC,GAAV,EAAejE,CAAf,EAAkB;AACpF,aAAO4D,iBAAiB,CAACN,GAAG,CAACW,GAAD,CAAJ,CAAjB,CAA4B9B,GAA5B,CAAgC,UAAUJ,IAAV,EAAgB;AAAE,eAAOtB,cAAc,CAAC,CAACwD,GAAD,CAAD,EAAQlC,IAAR,CAArB;AAAqC,OAAvF,CAAP;AACH,KAFuD,CAAtC,EAEdX,OAAO,CAAC+B,IAAR,CAAaG,GAAb,CAFc,CAAlB;AAGA,WAAOO,WAAP;AACH;;AACD,SAAO,CAAC,EAAD,CAAP;AACH,CAdD;;AAeA3C,OAAO,CAACgD,SAAR,GAAoB,UAAUC,OAAV,EAAmBC,aAAnB,EAAkC;AAClD,SAAOhD,OAAO,CAACgC,MAAR,CAAe,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACtC,QAAIe,WAAW,GAAGf,GAAlB;AACA,QAAIgB,OAAO,GAAGH,OAAO,CAACjB,SAAR,CAAkBmB,WAAlB,CAAd;AACA,QAAIE,OAAO,GAAGJ,OAAO,CAACK,SAAR,CAAkBH,WAAlB,CAAd;AACA,QAAII,0BAA0B,GAAGrD,OAAO,CAAC+B,IAAR,CAAaiB,aAAb,EAA4BM,MAA5B,CAAmC,UAAUT,GAAV,EAAe;AAAE,aAAO7C,OAAO,CAACuD,UAAR,CAAmBV,GAAnB,EAAwBI,WAAxB,CAAP;AAA8C,KAAlG,CAAjC;AACA,WAAOjD,OAAO,CAAC2B,MAAR,CAAe0B,0BAA0B,CAACtC,GAA3B,CAA+B,UAAUyC,WAAV,EAAuB;AACxE,UAAIC,GAAG,GAAGT,aAAa,CAACQ,WAAD,CAAvB;AACA,aAAO;AAAEA,QAAAA,WAAW,EAAEA,WAAf;AAA4BP,QAAAA,WAAW,EAAEA,WAAzC;AAAsDC,QAAAA,OAAO,EAAEA,OAA/D;AAAwEC,QAAAA,OAAO,EAAEA,OAAjF;AAA0FM,QAAAA,GAAG,EAAEA;AAA/F,OAAP;AACH,KAHqB,CAAf,EAGHxB,GAHG,CAAP;AAIH,GATM,EASJ,EATI,EASAjC,OAAO,CAAC+B,IAAR,CAAagB,OAAO,CAACK,SAArB,CATA,CAAP;AAUH,CAXD,C,CAYA;;;AACAtD,OAAO,CAAC4D,cAAR,GAAyB,UAAUC,WAAV,EAAuBC,QAAvB,EAAiCC,GAAjC,EAAsC;AAC3D,MAAID,QAAQ,CAAC7E,MAAT,KAAoB,CAAxB,EAA2B;AACvB,WAAO8E,GAAP;AACH;;AACD,MAAI7D,OAAO,CAAC8D,OAAR,CAAgBF,QAAhB,EAA0BC,GAA1B,CAAJ,EAAoC;AAChC,WAAO7D,OAAO,CAACW,IAAR,CAAaiD,QAAb,EAAuBC,GAAvB,CAAP;AACH,GAFD,MAGK;AACD,WAAOF,WAAP;AACH;AACJ,CAVD;;AAWA7D,OAAO,CAACiE,aAAR,GAAwB,UAAUC,IAAV,EAAgB;AACpC,MAAIC,SAAS,GAAGzB,iBAAiB,CAACwB,IAAD,CAAjC;AACA,SAAOhE,OAAO,CAACgC,MAAR,CAAe,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACtC,QAAIgC,EAAJ;;AACA,QAAIC,SAAS,GAAGrE,OAAO,CAACY,WAAR,CAAoBwB,GAApB,CAAhB;AACA,QAAIkC,WAAW,GAAGtE,OAAO,CAAC4D,cAAR,CAAuBW,SAAvB,EAAkCnC,GAAlC,EAAuC8B,IAAvC,CAAlB;AACA,QAAIM,WAAW,GAAGxE,OAAO,CAACS,kBAAR,CAA2B6D,WAA3B,IAA0CpE,OAAO,CAAC+B,IAAR,CAAaqC,WAAb,CAA1C,GAAsEA,WAAxF;AACA,WAAO7F,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK0D,GAAL,CAAT,GAAqBiC,EAAE,GAAG,EAAL,EAASA,EAAE,CAACC,SAAD,CAAF,GAAgBG,WAAzB,EAAsCJ,EAA3D,EAAf;AACH,GANM,EAMJ,EANI,EAMAD,SANA,CAAP;AAOH,CATD;;AAUAnE,OAAO,CAACyE,aAAR,GAAwB,UAAUC,KAAV,EAAiB;AACrC,MAAIC,MAAM,GAAG,EAAb;AACA,MAAIC,KAAK,GAAG1E,OAAO,CAACc,OAAR,CAAgBd,OAAO,CAACe,GAAR,CAAY,UAAU8B,GAAV,EAAe;AAAE,WAAQ;AAAElC,MAAAA,IAAI,EAAEb,OAAO,CAACe,WAAR,CAAoBgC,GAApB,CAAR;AAAkCX,MAAAA,GAAG,EAAEsC,KAAK,CAAC3B,GAAD;AAA5C,KAAR;AAA+D,GAA5F,CAAhB,EAA+G7C,OAAO,CAAC+B,IAAvH,EAA6HyC,KAA7H,CAAZ;AACAE,EAAAA,KAAK,CAAC3D,GAAN,CAAU,UAAU4D,OAAV,EAAmB;AAAE,WAAOF,MAAM,GAAGzE,OAAO,CAAC4E,SAAR,CAAkBD,OAAO,CAAChE,IAA1B,EAAgCgE,OAAO,CAACzC,GAAxC,EAA6CuC,MAA7C,CAAhB;AAAuE,GAAtG;AACA,SAAOA,MAAP;AACH,CALD;;AAMA3E,OAAO,CAAC+E,QAAR,GAAmB7E,OAAO,CAAC8E,KAAR,CAAc,UAAUC,EAAV,EAAclB,GAAd,EAAmB;AAAE,SAAO7D,OAAO,CAACgF,SAAR,CAAkBhF,OAAO,CAACe,GAAR,CAAYf,OAAO,CAACiF,MAAR,CAAe,CAAf,EAAkBF,EAAlB,CAAZ,EAAmC/E,OAAO,CAACkF,OAAR,CAAgBrB,GAAhB,CAAnC,CAAlB,CAAP;AAAqF,CAAxH,CAAnB;AACA/D,OAAO,CAACqF,eAAR,GAA0BnF,OAAO,CAAC8E,KAAR,CAAc,UAAUpF,CAAV,EAAa0F,CAAb,EAAgB;AAAE,SAAOpF,OAAO,CAACc,OAAR,CAAgBd,OAAO,CAACY,IAAR,CAAa,GAAb,CAAhB,EAAmCZ,OAAO,CAACqF,MAAR,CAAerF,OAAO,CAACsF,OAAvB,CAAnC,EAAoE,CAAC5F,CAAD,EAAI0F,CAAJ,CAApE,CAAP;AAAqF,CAArH,CAA1B;;AACAtF,OAAO,CAACyF,qBAAR,GAAgC,UAAUC,aAAV,EAAyBC,IAAzB,EAA+B;AAC3D,MAAIhB,MAAM,GAAGzE,OAAO,CAACgC,MAAR,CAAe,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC5C,QAAIgC,EAAJ;;AACA,QAAIwB,SAAS,GAAGzD,GAAG,CAACnC,OAAO,CAACY,WAAR,CAAoBV,OAAO,CAAC2F,QAAR,CAAiB,CAAjB,EAAoBzD,GAApB,CAApB,CAAD,CAAnB;AACA,QAAIlC,OAAO,CAAC4F,KAAR,CAAcF,SAAd,CAAJ,EACI,OAAOzD,GAAP;AACJ,QAAI4D,SAAS,GAAG7F,OAAO,CAAC8F,OAAR,CAAgB9F,OAAO,CAAC+F,QAAR,CAAiB/F,OAAO,CAACgG,IAAR,CAAa9D,GAAb,CAAjB,CAAhB,EAAqDwD,SAArD,CAAhB;AACA,QAAIO,aAAa,GAAGnG,OAAO,CAACY,WAAR,CAAoBV,OAAO,CAAC2F,QAAR,CAAiB,CAAjB,EAAoBzD,GAApB,CAApB,CAApB;;AACA,QAAIgE,UAAU,GAAG3H,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK0D,GAAL,CAAT,GAAqBiC,EAAE,GAAG,EAAL,EAASA,EAAE,CAAC+B,aAAD,CAAF,GAAoBJ,SAA7B,EAAwC3B,EAA7D,EAAzB;;AACA,WAAOgC,UAAP;AACH,GATY,EASVT,IATU,EASJD,aATI,CAAb;AAUA,SAAOf,MAAP;AACH,CAZD;;AAaA,IAAI0B,WAAW,GAAG;AACdC,EAAAA,IAAI,EAAE,MADQ;AAEdC,EAAAA,GAAG,EAAE,EAFS;AAGdC,EAAAA,IAAI,EAAE,CAAC,MAAD,EAAS,KAAT,EAAgB,MAAhB,CAHQ;AAIdC,EAAAA,QAAQ,EAAE;AACNC,IAAAA,WAAW,EAAE,KADP;AAENC,IAAAA,kBAAkB,EAAE;AAFd;AAJI,CAAlB;AASA,IAAIC,QAAQ,GAAG;AACX,eAAa,CAAC,MAAD,EAAS,KAAT,EAAgB,MAAhB,EAAwB,UAAxB,CADF;AAEX,mBAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFN;AAGX,uBAAqB,CAAC,aAAD,EAAgB,oBAAhB;AAHV,CAAf;AAKA,IAAIC,aAAa,GAAG;AAChB,kBAAgB,EADA;AAEhB,qBAAmB,MAFH;AAGhB,qBAAmB,KAHH;AAIhB,qBAAmB,MAJH;AAKhB,mBAAiB,MALD;AAMhB,mCAAiC,KANjB;AAOhB,0CAAwC;AAPxB,CAApB","sourcesContent":["\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ramda_1 = require(\"ramda\");\r\nvar serialize = require('serialize-javascript');\r\nexports.is_array = function (el) { return ramda_1.type(el) === 'Array'; };\r\nexports.is_object = function (el) { return ramda_1.type(el) === 'Object'; };\r\nexports.is_array_or_object = function (el) { return ramda_1.type(el) === 'Array' || ramda_1.type(el) === 'Object'; };\r\nexports.is_numeric_string = ramda_1.test(/^0$|^[1-9][0-9]*$/);\r\nexports.path_to_key = function (path) { return ramda_1.type(path) === \"Array\" ? path.join('.') : path; };\r\nexports.key_to_path = function (path) { return ramda_1.type(path) === \"String\" ? ramda_1.compose(ramda_1.map(function (el) { return exports.is_numeric_string(el) ? Number(el) : el; }), ramda_1.split('.'))(path) : path; };\r\nexports.stringify = function (value) { return serialize(value, { ignoreFunction: true }); };\r\nexports.parse = function (serializedJavascript) { return eval('(' + serializedJavascript + ')'); };\r\nexports.concat_if_nonexistent = function (array, append_array) { return ramda_1.compose(ramda_1.uniq, ramda_1.concat(array))(append_array); };\r\n// returns new_pairs with all the index values from existing_pairs merged in\r\nexports.merge_keys = function (existing_pairs, new_pairs, keys) { return ramda_1.reduce(function (acc, val) {\r\n    var existing_value = existing_pairs[val];\r\n    var new_value = new_pairs[val];\r\n    if (!Array.isArray(existing_value) || !Array.isArray(new_value)) {\r\n        return ramda_1.assoc(val, new_value, acc);\r\n    }\r\n    else {\r\n        var merged_value = exports.concat_if_nonexistent(existing_value, new_value);\r\n        return ramda_1.assoc(val, merged_value, acc);\r\n    }\r\n}, new_pairs)(keys); };\r\nvar json_to_path_list = function (val) {\r\n    if (Array.isArray(val)) {\r\n        var child_paths = ramda_1.unnest(val.map(function (child, i) {\r\n            return json_to_path_list(child).map(function (path) { return __spreadArrays([i], path); });\r\n        }));\r\n        return ramda_1.concat([[]], child_paths);\r\n    }\r\n    if (exports.is_object(val)) {\r\n        var child_paths = ramda_1.compose(ramda_1.concat([[]]), ramda_1.chain(function (key, i) {\r\n            return json_to_path_list(val[key]).map(function (path) { return __spreadArrays([key], path); });\r\n        }))(ramda_1.keys(val));\r\n        return child_paths;\r\n    }\r\n    return [[]];\r\n};\r\nexports.who_cares = function (changes, subscriptions) {\r\n    return ramda_1.reduce(function (acc, val) {\r\n        var changed_key = val;\r\n        var new_val = changes.new_pairs[changed_key];\r\n        var old_val = changes.old_pairs[changed_key];\r\n        var relevant_subscription_keys = ramda_1.keys(subscriptions).filter(function (key) { return ramda_1.startsWith(key)(changed_key); });\r\n        return ramda_1.concat(relevant_subscription_keys.map(function (watched_key) {\r\n            var fns = subscriptions[watched_key];\r\n            return { watched_key: watched_key, changed_key: changed_key, new_val: new_val, old_val: old_val, fns: fns };\r\n        }), acc);\r\n    }, [])(ramda_1.keys(changes.old_pairs));\r\n};\r\n// like pathOr but doesnt return null when value is null and not undefined\r\nexports.strict_path_or = function (default_val, val_path, obj) {\r\n    if (val_path.length === 0) {\r\n        return obj;\r\n    }\r\n    if (ramda_1.hasPath(val_path, obj)) {\r\n        return ramda_1.path(val_path, obj);\r\n    }\r\n    else {\r\n        return default_val;\r\n    }\r\n};\r\nexports.json_to_pairs = function (json) {\r\n    var path_list = json_to_path_list(json);\r\n    return ramda_1.reduce(function (acc, val) {\r\n        var _a;\r\n        var redis_key = exports.path_to_key(val);\r\n        var given_value = exports.strict_path_or(undefined, val, json);\r\n        var redis_value = exports.is_array_or_object(given_value) ? ramda_1.keys(given_value) : given_value;\r\n        return __assign(__assign({}, acc), (_a = {}, _a[redis_key] = redis_value, _a));\r\n    }, {})(path_list);\r\n};\r\nexports.pairs_to_json = function (pairs) {\r\n    var output = {};\r\n    var paths = ramda_1.compose(ramda_1.map(function (key) { return ({ path: exports.key_to_path(key), val: pairs[key] }); }), ramda_1.keys)(pairs);\r\n    paths.map(function (path_el) { return output = ramda_1.assocPath(path_el.path, path_el.val, output); });\r\n    return output;\r\n};\r\nexports.map_keys = ramda_1.curry(function (fn, obj) { return ramda_1.fromPairs(ramda_1.map(ramda_1.adjust(0, fn), ramda_1.toPairs(obj))); });\r\nexports.concat_with_dot = ramda_1.curry(function (a, b) { return ramda_1.compose(ramda_1.join('.'), ramda_1.reject(ramda_1.isEmpty))([a, b]); });\r\nexports.delete_parent_indices = function (missing_paths, data) {\r\n    var output = ramda_1.reduce(function (acc, val) {\r\n        var _a;\r\n        var old_index = acc[exports.path_to_key(ramda_1.dropLast(1, val))];\r\n        if (ramda_1.isNil(old_index))\r\n            return acc;\r\n        var new_index = ramda_1.without(ramda_1.toString(ramda_1.last(val)))(old_index);\r\n        var key_to_update = exports.path_to_key(ramda_1.dropLast(1, val));\r\n        var update_obj = __assign(__assign({}, acc), (_a = {}, _a[key_to_update] = new_index, _a));\r\n        return update_obj;\r\n    }, data, missing_paths);\r\n    return output;\r\n};\r\nvar sample_json = {\r\n    name: 'John',\r\n    age: 30,\r\n    cars: ['Ford', 'BMW', 'fiat'],\r\n    settings: {\r\n        likes_pizza: false,\r\n        wants_daily_emails: true\r\n    }\r\n};\r\nvar pointers = {\r\n    'redibase_': ['name', 'age', 'cars', 'settings'],\r\n    'redibase_cars': [0, 1, 2],\r\n    'redibase_settings': ['likes_pizza', 'wants_daily_emails'],\r\n};\r\nvar redis_entries = {\r\n    'redibase_age': 30,\r\n    'redibase_cars.0': 'Ford',\r\n    'redibase_cars.1': 'BMW',\r\n    'redibase_cars.2': 'fiat',\r\n    'redibase_name': 'John',\r\n    'redibase_settings.likes_pizza': false,\r\n    'redibase_settings.wants_daily_emails': true\r\n};\r\n"]},"metadata":{},"sourceType":"script"}