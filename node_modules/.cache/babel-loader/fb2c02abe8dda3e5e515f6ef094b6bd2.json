{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\gamem\\\\codecademy\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\gamem\\\\codecademy\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar utils_1 = require(\"../utils\");\n\nvar Deque = require(\"denque\");\n\nvar debug = utils_1.Debug(\"delayqueue\");\n/**\n * Queue that runs items after specified duration\n *\n * @export\n * @class DelayQueue\n */\n\nvar DelayQueue =\n/*#__PURE__*/\nfunction () {\n  function DelayQueue() {\n    _classCallCheck(this, DelayQueue);\n\n    this.queues = {};\n    this.timeouts = {};\n  }\n  /**\n   * Add a new item to the queue\n   *\n   * @param {string} bucket bucket name\n   * @param {Function} item function that will run later\n   * @param {IDelayQueueOptions} options\n   * @memberof DelayQueue\n   */\n\n\n  _createClass(DelayQueue, [{\n    key: \"push\",\n    value: function push(bucket, item, options) {\n      var _this = this;\n\n      var callback = options.callback || process.nextTick;\n\n      if (!this.queues[bucket]) {\n        this.queues[bucket] = new Deque();\n      }\n\n      var queue = this.queues[bucket];\n      queue.push(item);\n\n      if (!this.timeouts[bucket]) {\n        this.timeouts[bucket] = setTimeout(function () {\n          callback(function () {\n            _this.timeouts[bucket] = null;\n\n            _this.execute(bucket);\n          });\n        }, options.timeout);\n      }\n    }\n  }, {\n    key: \"execute\",\n    value: function execute(bucket) {\n      var queue = this.queues[bucket];\n\n      if (!queue) {\n        return;\n      }\n\n      var length = queue.length;\n\n      if (!length) {\n        return;\n      }\n\n      debug(\"send %d commands in %s queue\", length, bucket);\n      this.queues[bucket] = null;\n\n      while (queue.length > 0) {\n        queue.shift()();\n      }\n    }\n  }]);\n\n  return DelayQueue;\n}();\n\nexports.default = DelayQueue;","map":{"version":3,"sources":["C:/Users/gamem/codecademy/node_modules/ioredis/built/cluster/DelayQueue.js"],"names":["Object","defineProperty","exports","value","utils_1","require","Deque","debug","Debug","DelayQueue","queues","timeouts","bucket","item","options","callback","process","nextTick","queue","push","setTimeout","execute","timeout","length","shift","default"],"mappings":"AAAA;;;;;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAMC,OAAO,GAAGC,OAAO,CAAC,UAAD,CAAvB;;AACA,IAAMC,KAAK,GAAGD,OAAO,CAAC,QAAD,CAArB;;AACA,IAAME,KAAK,GAAGH,OAAO,CAACI,KAAR,CAAc,YAAd,CAAd;AACA;;;;;;;IAMMC,U;;;AACF,wBAAc;AAAA;;AACV,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACH;AACD;;;;;;;;;;;;yBAQKC,M,EAAQC,I,EAAMC,O,EAAS;AAAA;;AACxB,UAAMC,QAAQ,GAAGD,OAAO,CAACC,QAAR,IAAoBC,OAAO,CAACC,QAA7C;;AACA,UAAI,CAAC,KAAKP,MAAL,CAAYE,MAAZ,CAAL,EAA0B;AACtB,aAAKF,MAAL,CAAYE,MAAZ,IAAsB,IAAIN,KAAJ,EAAtB;AACH;;AACD,UAAMY,KAAK,GAAG,KAAKR,MAAL,CAAYE,MAAZ,CAAd;AACAM,MAAAA,KAAK,CAACC,IAAN,CAAWN,IAAX;;AACA,UAAI,CAAC,KAAKF,QAAL,CAAcC,MAAd,CAAL,EAA4B;AACxB,aAAKD,QAAL,CAAcC,MAAd,IAAwBQ,UAAU,CAAC,YAAM;AACrCL,UAAAA,QAAQ,CAAC,YAAM;AACX,YAAA,KAAI,CAACJ,QAAL,CAAcC,MAAd,IAAwB,IAAxB;;AACA,YAAA,KAAI,CAACS,OAAL,CAAaT,MAAb;AACH,WAHO,CAAR;AAIH,SALiC,EAK/BE,OAAO,CAACQ,OALuB,CAAlC;AAMH;AACJ;;;4BACOV,M,EAAQ;AACZ,UAAMM,KAAK,GAAG,KAAKR,MAAL,CAAYE,MAAZ,CAAd;;AACA,UAAI,CAACM,KAAL,EAAY;AACR;AACH;;AAJW,UAKJK,MALI,GAKOL,KALP,CAKJK,MALI;;AAMZ,UAAI,CAACA,MAAL,EAAa;AACT;AACH;;AACDhB,MAAAA,KAAK,CAAC,8BAAD,EAAiCgB,MAAjC,EAAyCX,MAAzC,CAAL;AACA,WAAKF,MAAL,CAAYE,MAAZ,IAAsB,IAAtB;;AACA,aAAOM,KAAK,CAACK,MAAN,GAAe,CAAtB,EAAyB;AACrBL,QAAAA,KAAK,CAACM,KAAN;AACH;AACJ;;;;;;AAELtB,OAAO,CAACuB,OAAR,GAAkBhB,UAAlB","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_1 = require(\"../utils\");\nconst Deque = require(\"denque\");\nconst debug = utils_1.Debug(\"delayqueue\");\n/**\n * Queue that runs items after specified duration\n *\n * @export\n * @class DelayQueue\n */\nclass DelayQueue {\n    constructor() {\n        this.queues = {};\n        this.timeouts = {};\n    }\n    /**\n     * Add a new item to the queue\n     *\n     * @param {string} bucket bucket name\n     * @param {Function} item function that will run later\n     * @param {IDelayQueueOptions} options\n     * @memberof DelayQueue\n     */\n    push(bucket, item, options) {\n        const callback = options.callback || process.nextTick;\n        if (!this.queues[bucket]) {\n            this.queues[bucket] = new Deque();\n        }\n        const queue = this.queues[bucket];\n        queue.push(item);\n        if (!this.timeouts[bucket]) {\n            this.timeouts[bucket] = setTimeout(() => {\n                callback(() => {\n                    this.timeouts[bucket] = null;\n                    this.execute(bucket);\n                });\n            }, options.timeout);\n        }\n    }\n    execute(bucket) {\n        const queue = this.queues[bucket];\n        if (!queue) {\n            return;\n        }\n        const { length } = queue;\n        if (!length) {\n            return;\n        }\n        debug(\"send %d commands in %s queue\", length, bucket);\n        this.queues[bucket] = null;\n        while (queue.length > 0) {\n            queue.shift()();\n        }\n    }\n}\nexports.default = DelayQueue;\n"]},"metadata":{},"sourceType":"script"}